external_components:
  - source:
      type: git
      url: https://github.com/heinekmadsen/esphome_GenvexV3
      ref: master
    refresh: 0s
    components: [genvex]

# Root component
genvex:
  id: my_genvex

# Modbus number and sensor to wire climate (example addresses)
number:
  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Target Temperature"
    id: genvex_target_temp
    register_type: holding
    value_type: U_WORD
    min_value: 10
    max_value: 30
    step: 0.1
    address: 0
    lambda: "return ((x+100)/10);"
    write_lambda: |-
      uint16_t new_temp = x * 10 - 100;
      return new_temp;

sensor:
  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Current Temperature"
    id: genvex_current_temp
    unit_of_measurement: "Â°C"
    accuracy_decimals: 1
    device_class: temperature
    value_type: U_WORD
    register_type: read
    address: 6
    lambda: "return ((x - 300) / 10);"

  # Additional sensors from Modbus documentation
  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Bypass"
    id: genvex_bypass
    unit_of_measurement: "%"
    value_type: U_WORD
    register_type: read
    address: 104

  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Water Valve"
    id: genvex_water_valve
    unit_of_measurement: "%"
    value_type: U_WORD
    register_type: read
    address: 105

  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Humidity Fan Control"
    id: genvex_humidity_fan_control
    unit_of_measurement: "%"
    value_type: U_WORD
    register_type: read
    address: 106

climate:
  - platform: genvex
    name: Genvex
    genvex_id: my_genvex
    current_temp_sensor_id: genvex_current_temp
    target_temp_number_id: genvex_target_temp
    fan_speed_number_id: genvex_ventilation_speed

select:
  - platform: genvex
    name: "Genvex Speed Mode"
    genvex_id: my_genvex
    speed_number_id: genvex_ventilation_speed
    options:
      - "Off"
      - "1"
      - "2"
      - "3"
      - "4"

  - platform: genvex
    name: "Genvex Timer"
    genvex_id: my_genvex
    timer_number_id: genvex_timer_number
    options:
      - "Off"
      - "1"
      - "2"
      - "3"
      - "4"
      - "5"
      - "6"
      - "7"
      - "8"
      - "9"

number:
  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Ventilation speed"
    id: genvex_ventilation_speed
    min_value: 0
    max_value: 4
    step: 1.0
    address: 100

  - platform: modbus_controller
    modbus_controller_id: genvex_modbus_controller
    name: "Genvex Timer"
    id: genvex_timer_number
    min_value: 0
    max_value: 9
    step: 1.0
    address: 106
